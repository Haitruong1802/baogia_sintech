<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Xu·∫•t b√°o gi√° Sintech</title>
</head>
<body>
  <h2>Th√¥ng tin kh√°ch h√†ng</h2>
  <div>
    <input id="customer-name" type="text" placeholder="T√™n kh√°ch h√†ng" />
    <input id="customer-phone" type="text" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
    <input id="customer-address" type="text" placeholder="ƒê·ªãa ch·ªâ" />
  </div>
  
  <br>
  <!-- N√∫t Xu·∫•t Excel -->
  <button onclick="exportBaoGiaSintech()">Xu·∫•t b√°o gi√° Excel</button>

  <script>
    // V√≠ d·ª• pc_components gi·∫£ l·∫≠p, th·ª±c t·∫ø b·∫°n l·∫•y data t·ª´ build pc c·ªßa b·∫°n
    const pc_components = [
      { name: "CPU", handle: "cpu" },
      { name: "RAM", handle: "ram" }
    ];

    // D·ªØ li·ªáu m·∫´u ƒë·ªÉ test nhanh (sau n√†y b·∫°n thay b·∫±ng localStorage th·∫≠t c·ªßa b·∫°n)
    localStorage.setItem('buildpc_cpu', JSON.stringify({
      title: "Intel Core i5-12400F",
      brand: "Intel",
      qty: 1,
      price: 2790000,
      warranty: "36 th√°ng"
    }));
    localStorage.setItem('buildpc_ram', JSON.stringify({
      title: "RAM 16GB DDR4",
      brand: "Kingston",
      qty: 2,
      price: 800000,
      warranty: "36 th√°ng"
    }));

    function exportBaoGiaSintech() {
      const items = [];
      pc_components.forEach(comp => {
        const data = JSON.parse(localStorage.getItem('buildpc_' + comp.handle) || 'null');
        if (data) {
          items.push({
            group: comp.name,
            name: data.title,
            brand: data.brand || data.desc || "",
            qty: data.qty || 1,
            price: Number(data.price || 0),
            total: (data.qty || 1) * Number(data.price || 0),
            warranty: data.warranty || ""
          });
        }
      });

      if (items.length === 0) {
        alert("B·∫°n ch∆∞a ch·ªçn linh ki·ªán n√†o!");
        return;
      }

      const customer = {
        name: document.getElementById('customer-name').value || "",
        phone: document.getElementById('customer-phone').value || "",
        address: document.getElementById('customer-address').value || ""
      };

      // ƒê·ªïi link b√™n d∆∞·ªõi th√†nh link Vercel c·ªßa b·∫°n!
      fetch('https://baogia-sintech.vercel.app/api/bao-gia-excel', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ items, customer })
      })
      .then(res => {
        if (!res.ok) throw new Error('T·∫£i file th·∫•t b·∫°i');
        return res.blob();
      })
      .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'bao_gia_sintech.xlsx';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          window.URL.revokeObjectURL(url);
          a.remove();
        }, 1000);
      })
      .catch(e => alert('C√≥ l·ªói khi xu·∫•t b√°o gi√° xin vui l√≤ng th·ª≠ l·∫°i sau ü•∫'));
    }
  </script>
</body>
</html>
